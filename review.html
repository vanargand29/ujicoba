<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J Store - Review & Rating</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom styles for star ratings */
    .star-rating {
      display: inline-flex;
      flex-direction: row-reverse;
    }
    .star-rating input[type="radio"] {
      display: none;
    }
    .star-rating label {
      font-size: 2rem;
      color: #4a5568;
      cursor: pointer;
      transition: color 0.2s;
    }
    .star-rating input[type="radio"]:checked ~ label,
    .star-rating label:hover,
    .star-rating label:hover ~ label {
      color: #fcd34d;
    }
    .review-item {
      border: 1px solid #2d3748;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      background-color: #2d3748;
      color: #e2e8f0;
    }
    .avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: #4a5568;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #cbd5e0;
    }
    body {
      background-color: #1a202c;
      color: #e2e8f0;
    }
    .container-main {
      background-color: #2d3748;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                  0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .header-nav {
      background-color: #2a4365;
      padding: 1rem 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .header-nav .container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1280px;
      margin-left: auto;
      margin-right: auto;
      padding-left: 1rem;
      padding-right: 1rem;
    }
    .header-nav .logo {
      font-size: 1.75rem;
      font-weight: bold;
      color: #90cdf4;
    }
    .header-nav .nav-links {
      display: flex;
      gap: 1.5rem;
    }
    .header-nav .nav-links a {
      color: #e2e8f0;
      font-weight: 600;
      transition: color 0.2s;
    }
    .header-nav .nav-links a:hover {
      color: #90cdf4;
    }
    .burger-menu {
      display: none;
      flex-direction: column;
      cursor: pointer;
    }
    .burger-menu span {
      height: 3px;
      width: 25px;
      background-color: #e2e8f0;
      margin-bottom: 4px;
      border-radius: 2px;
    }
    @media (max-width: 768px) {
      .header-nav .nav-links {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 64px;
        left: 0;
        width: 100%;
        background-color: #2a4365;
        padding: 1rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        z-index: 10;
      }
      .header-nav .nav-links.active {
        display: flex;
      }
      .header-nav .nav-links a {
        padding: 0.75rem 0;
        border-bottom: 1px solid #4a5568;
        text-align: center;
      }
      .header-nav .nav-links a:last-child {
        border-bottom: none;
      }
      .burger-menu {
        display: flex;
      }
    }
  </style>
</head>
<body class="font-sans">
  <nav class="header-nav">
    <div class="container">
      <div class="logo">J Store</div>
      <div class="nav-links" id="navLinks">
        <a href="index.html">Home</a>
        <a href="skyevent.html">Sky: Children of The Light</a>
        <a href="roblox.html">Roblox</a>
        <a href="review.html">Review</a>
      </div>
      <div class="burger-menu" id="burgerMenu">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </nav>

  <div class="container-main mx-auto px-4 py-8 mt-8 max-w-4xl">
    <header class="text-center mb-8">
      <h1 class="text-4xl font-bold">Review & Rating</h1>
      <p class="mt-2">Share your opinions and see what others think!</p>
    </header>
    <button id="addReviewBtn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-8">
      Add Review
    </button>
    <div id="reviewsContainer" class="space-y-4"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center hidden">
    <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-md modal-content">
      <h2 class="text-2xl font-bold mb-4">Add Your Review</h2>
      <form id="reviewForm">
        <div class="mb-4">
          <label class="block font-bold mb-2" for="email">Email</label>
          <input id="email" type="email" required class="shadow border rounded w-full py-2 px-3" />
        </div>
        <div class="mb-4">
          <label class="block font-bold mb-2" for="name">Name</label>
          <input id="name" type="text" required class="shadow border rounded w-full py-2 px-3" />
        </div>
        <div class="mb-4">
          <label class="block font-bold mb-2">Rating</label>
          <div class="star-rating">
            <input type="radio" id="star5" name="rating" value="5" /><label for="star5">&#9733;</label>
            <input type="radio" id="star4" name="rating" value="4" /><label for="star4">&#9733;</label>
            <input type="radio" id="star3" name="rating" value="3" /><label for="star3">&#9733;</label>
            <input type="radio" id="star2" name="rating" value="2" /><label for="star2">&#9733;</label>
            <input type="radio" id="star1" name="rating" value="1" /><label for="star1">&#9733;</label>
          </div>
        </div>
        <div class="mb-4">
          <label class="block font-bold mb-2" for="description">Description</label>
          <textarea id="description" rows="4" required class="shadow border rounded w-full py-2 px-3"></textarea>
        </div>
        <div class="mb-4">
          <label class="block font-bold mb-2" for="photo">Photo (Optional)</label>
          <input type="file" id="photo" accept="image/*" class="block w-full" />
        </div>
        <div class="flex justify-between">
          <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
            Submit
          </button>
          <button type="button" id="closeModalBtn" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const GOOGLE_APPS_SCRIPT_WEB_APP_URL =
      "https://script.google.com/macros/s/AKfycbxTU1viQtgqCgdBaIjTKzMuSC29d-ZRyYSk5TkzWBbcAzSWJsIZ47kuWqjkkbRBIqLM/exec";

    const addReviewBtn = document.getElementById("addReviewBtn");
    const modal = document.getElementById("modal");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const reviewForm = document.getElementById("reviewForm");
    const reviewsContainer = document.getElementById("reviewsContainer");
    const burgerMenu = document.getElementById("burgerMenu");
    const navLinks = document.getElementById("navLinks");

    burgerMenu.addEventListener("click", () => {
      navLinks.classList.toggle("active");
    });

    addReviewBtn.addEventListener("click", () => {
      modal.classList.remove("hidden");
    });

    closeModalBtn.addEventListener("click", () => {
      modal.classList.add("hidden");
      reviewForm.reset();
    });

    reviewForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const name = document.getElementById("name").value.trim();
      const rating = document.querySelector('input[name="rating"]:checked')?.value || "0";
      const description = document.getElementById("description").value.trim();
      const photoFile = document.getElementById("photo").files[0];
      let photoUrl = "";

      if (photoFile) {
        const reader = new FileReader();
        reader.onload = async function (event) {
          photoUrl = event.target.result;
          await sendReviewToGoogleSheets(email, name, rating, description, photoUrl);
          modal.classList.add("hidden");
          reviewForm.reset();
        };
        reader.readAsDataURL(photoFile);
      } else {
        await sendReviewToGoogleSheets(email, name, rating, description, photoUrl);
        modal.classList.add("hidden");
        reviewForm.reset();
      }
    });

    async function sendReviewToGoogleSheets(email, nama, rating, description, foto) {
      const reviewData = {
        action: "insert",
        email,
        nama,
        rating: parseInt(rating),
        description,
        foto,
      };

      try {
        const response = await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(reviewData),
        });

        if (!response.ok) throw new Error("Server error: " + response.status);

        const result = await response.json();
        console.log("Review added:", result);

        if (result.success) {
          displayReviews();
        } else {
          alert("Failed to add review: " + (result.message || "Unknown error"));
        }
      } catch (err) {
        console.error("Error sending review:", err);
        alert("Failed to add review: " + err.message);
      }
    }

    async function displayReviews() {
      reviewsContainer.innerHTML = "";
      try {
        const response = await fetch(GOOGLE_APPS_SCRIPT_WEB_APP_URL, { method: "GET" });
        if (!response.ok) throw new Error("Server error");
        const result = await response.json();
        let reviews = result.data;

        if (!Array.isArray(reviews)) reviews = [];

        if (reviews.length === 0) {
          reviewsContainer.innerHTML =
            '<p class="text-center text-gray-400">No reviews yet.</p>';
          return;
        }

        reviews.sort((a, b) => new Date(b.Timestamp) - new Date(a.Timestamp));

        reviews.forEach((review) => {
          const reviewDiv = document.createElement("div");
          reviewDiv.className = "review-item";
          reviewDiv.innerHTML = `
            <div class="flex items-start space-x-4">
              <div class="avatar">${review.nama?.charAt(0) || "?"}</div>
              <div class="flex-1">
                <div class="flex items-center mb-2">
                  <h3 class="text-lg font-bold">${review.nama}</h3>
                  <span class="ml-2 text-sm text-gray-500">${new Date(review.Timestamp).toLocaleString()}</span>
                </div>
                <div class="flex items-center mb-2">
                  ${Array.from({ length: 5 }, (_, i) =>
                    `<span class="text-yellow-400 ${
                      i < review.rating ? "" : "text-gray-600"
                    }">&#9733;</span>`
                  ).join("")}
                </div>
                <p class="mb-2">${review.description}</p>
                ${review.foto ? `<img src="${review.foto}" class="w-full max-w-md rounded mt-2" />` : ""}
              </div>
            </div>`;
          reviewsContainer.appendChild(reviewDiv);
        });
      } catch (err) {
        console.error(err);
        reviewsContainer.innerHTML =
          `<p class="text-center text-red-500">Failed to load reviews</p>`;
      }
    }

    window.addEventListener("load", displayReviews);
  </script>
</body>
</html>
